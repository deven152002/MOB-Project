###
###              ejabberd configuration file
###
### The parameters used in this configuration file are explained at
###
###       https://docs.ejabberd.im/admin/configuration
###
### The configuration file is written in YAML.
### *************************************************************************
### *                                                                       *
### *   WARNING: Do not modify this file manually. Use ejabberdctl instead. *
### *                                                                       *
### *************************************************************************
###
### Refer to admin guide for more info: https://docs.ejabberd.im/admin/configuration/basic/
###

### The 'listen' option defines which ports will be used by ejabberd to listen.
listen:
  -
    port: 5222
    ip: "::"
    module: ejabberd_c2s
    max_stanza_size: 262144
    shaper: c2s_shaper
    access: c2s
    starttls_required: false  # Changed from true to false
  -
    port: 5269
    ip: "::"
    module: ejabberd_s2s_in
    max_stanza_size: 524288
  -
    port: 5443
    ip: "::"
    module: ejabberd_http
    tls: true
    request_handlers:
      "/admin": ejabberd_web_admin
      "/api": mod_http_api
      "/bosh": mod_bosh
      "/captcha": ejabberd_captcha
      "/upload": mod_http_upload
      "/ws": ejabberd_http_ws
  -
    port: 5280
    ip: "::"
    module: ejabberd_http
    request_handlers:
      "/admin": ejabberd_web_admin
      "/api": mod_http_api
      "/bosh": mod_bosh
      "/captcha": ejabberd_captcha
      "/upload": mod_http_upload
      "/ws": ejabberd_http_ws
  -
    port: 1883
    ip: "::"
    module: mod_mqtt
    backlog: 1000

### Authentication method. Auth method is defined globally for all ejabberd vhosts.
auth_method: 
  - internal

### If you want to restrict the server to a predefined set of domains, declare
### the domains to serve here.
## hosts:
##   - "example.net"

### Don't allow registrations in localhost.
## host_config:
##   "localhost":
##     allow_users_registration: false

### Allow registration in other domains.
## host_config:
##   "example.net":
##     allow_users_registration: true

### Option, which could globally disable TLS. Right now applies only to
### MQTT listener. false by default.
## disable_tls: true

### Allow plain authentication both for c2s and for MQTT.
## Only enable after all clients switched to TLS encrypted sessions.
auth_password_format: plain  # Allow plain authentication for testing

### Custom TLS configuration
### TLS can be set globally for all listeners below.
### For all possible options, see https://docs.ejabberd.im/admin/configuration/tls/
### Right now TLS only can be set globally and not per listener.
###
### TLS enforcing modes:
###   tls: false
###     no TLS at all
###   tls: true
###     will require TLS/SSL
###   tls: optional
###     both TLS/SSL and non-TLS can be used
##
## tls:
##   verify_mode: peer
##   dhfile: "/opt/homebrew/etc/ejabberd/dhparams.pem"
##   cafile: "/opt/homebrew/etc/ejabberd/ca.pem"
##   certfile: "/opt/homebrew/etc/ejabberd/ejabberd.pem"
##   protocol_options:
##     - "no_sslv3"
##     - "no_tlsv1"
##     - "no_tlsv1_1"

### Authentication options
###
###
### auth_method: anonymous
###   Anonymous login, no authentication.
###
### auth_method: external
###   Use external script to check authentication (see auth_external_spec).
###
### auth_method: internal
###   Use internal authentication on Mnesia.
###
### auth_method: jwt
###   Use JWT authentication.
###
### auth_method: ldap
###   Use LDAP to authenticate users.
###
### auth_method: pam
###   Use Unix PAM to authenticate users.
###
### auth_method: sql
###   Use external SQL DB to authenticate users.

## Modules enabled in all ejabberd virtual hosts.
##
modules:
  mod_adhoc: {}
  mod_admin_extra: {}
  mod_announce:
    access: announce
  mod_avatar: {}
  mod_blocking: {}
  mod_bosh: {}
  mod_caps: {}
  mod_carboncopy: {}
  mod_client_state: {}
  mod_configure: {}
  mod_disco: {}
  mod_fail2ban: {}
  mod_http_api: {}
  mod_http_upload:
    put_url: https://@HOST@:5443/upload
  mod_last: {}
  mod_mam:
    ## Mnesia is limited to 2GB, better to use an SQL backend
    ## For small servers SQLite is a good fit and is very easy
    ## to configure. Uncomment this when you have SQL configured:
    ## db_type: sql
    assume_mam_usage: true
    default: never
  mod_mqtt: {}
  mod_muc:
    access:
      - allow
    access_admin:
      - allow: admin
    access_create: muc_create
    access_persistent: muc_create
    default_room_options:
      mam: false
  mod_muc_admin: {}
  mod_offline:
    access_max_user_messages: max_user_offline_messages
  mod_ping: {}
  mod_privacy: {}
  mod_private: {}
  mod_proxy65:
    access: local
    max_connections: 5
  mod_pubsub:
    access_createnode: pubsub_createnode
    plugins:
      - flat
      - pep
    force_node_config:
      ## Avoid buggy clients to make their bookmarks public
      storage:bookmarks:
        access_model: whitelist
  mod_push: {}
  mod_push_keepalive: {}
  mod_register:
    ## Only accept registration requests from the "trusted"
    ## network.
    ## ip_access: trusted
    access: register
  mod_roster:
    versioning: true
  mod_s2s_dialback: {}
  mod_shared_roster: {}
  mod_stream_mgmt:
    resend_on_timeout: if_offline
  mod_vcard: {}
  mod_vcard_xupdate: {}
  mod_version:
    show_os: false 